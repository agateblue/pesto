<script lang="ts">
  import { v7 as uuidv7 } from 'uuid';
  import TextEditor from './TextEditor.svelte';
  import { createEventDispatcher } from 'svelte';

  const dispatch = createEventDispatcher<{created: DiaryEntry}>();

  export let cacheKey: null | string = null

  $: tree = {version: 0, nodes: []};

  function handleSubmit () {
    const entry: DiaryEntry = {
      _id: uuidv7(),
      date: new Date(),
      tree: tree,
    }
    dispatch('created', entry);
  }

</script>

<form on:submit|preventDefault={handleSubmit}>
  <TextEditor bind:tree={tree} bind:cacheKey={cacheKey} />
  <button type="submit">Submit</button>
</form>